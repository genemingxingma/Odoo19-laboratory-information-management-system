<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_lab_method_validation_list" model="ir.ui.view">
        <field name="name">lab.method.validation.list</field>
        <field name="model">lab.method.validation</field>
        <field name="arch" type="xml">
            <list decoration-danger="state == 'rejected' or state == 'expired'" decoration-success="state == 'approved'">
                <field name="name"/>
                <field name="service_id"/>
                <field name="method_version"/>
                <field name="validation_type"/>
                <field name="overall_pass"/>
                <field name="effective_from"/>
                <field name="effective_to"/>
                <field name="next_review_date"/>
                <field name="state"/>
            </list>
        </field>
    </record>

    <record id="view_lab_method_validation_form" model="ir.ui.view">
        <field name="name">lab.method.validation.form</field>
        <field name="model">lab.method.validation</field>
        <field name="arch" type="xml">
            <form string="Method Validation">
                <header>
                    <button name="action_start" type="object" string="Start" class="btn-primary" invisible="state != 'draft'"/>
                    <button name="action_submit" type="object" string="Submit" class="btn-primary" invisible="state not in ('draft','in_progress','rejected')"/>
                    <button name="action_approve" type="object" string="Approve" class="btn-primary" groups="laboratory_management.group_lab_quality_manager" invisible="state != 'pending_approval'"/>
                    <button name="action_reject" type="object" string="Reject" groups="laboratory_management.group_lab_quality_manager" invisible="state not in ('pending_approval','approved')"/>
                    <button name="action_expire" type="object" string="Expire" groups="laboratory_management.group_lab_quality_manager" invisible="state != 'approved'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,pending_approval,approved,rejected,expired"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="service_id"/>
                            <field name="method_version"/>
                            <field name="validation_type"/>
                            <field name="overall_pass"/>
                        </group>
                        <group>
                            <field name="effective_from"/>
                            <field name="effective_to"/>
                            <field name="review_interval_months"/>
                            <field name="next_review_date" readonly="1"/>
                            <field name="is_active_for_release" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Plan">
                            <group>
                                <field name="plan_note"/>
                                <field name="precision_plan"/>
                                <field name="accuracy_plan"/>
                                <field name="linearity_plan"/>
                                <field name="lod_loq_plan"/>
                                <field name="reference_interval_plan"/>
                                <field name="acceptance_criteria"/>
                            </group>
                        </page>
                        <page string="Results">
                            <group>
                                <field name="precision_result"/>
                                <field name="accuracy_result"/>
                                <field name="linearity_result"/>
                                <field name="lod_loq_result"/>
                                <field name="reference_interval_result"/>
                                <field name="summary_result"/>
                            </group>
                        </page>
                        <page string="Approval">
                            <group>
                                <group>
                                    <field name="approved_by_id" readonly="1"/>
                                    <field name="approved_at" readonly="1"/>
                                </group>
                                <group>
                                    <field name="rejected_by_id" readonly="1"/>
                                    <field name="rejected_at" readonly="1"/>
                                </group>
                            </group>
                            <group>
                                <field name="reject_reason" placeholder="Reason is required when rejecting validation"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="view_lab_method_validation_search" model="ir.ui.view">
        <field name="name">lab.method.validation.search</field>
        <field name="model">lab.method.validation</field>
        <field name="arch" type="xml">
            <search>
                <field name="service_id"/>
                <field name="method_version"/>
                <field name="state"/>
                <filter name="f_pending" string="Pending Approval" domain="[('state','=','pending_approval')]"/>
                <filter name="f_approved" string="Approved" domain="[('state','=','approved')]"/>
                <filter name="f_expiring" string="Review Due Soon" domain="[('next_review_date','!=',False),('next_review_date','&lt;=',context_today())]"/>
            </search>
        </field>
    </record>

    <record id="action_lab_method_validation" model="ir.actions.act_window">
        <field name="name">Method Validation</field>
        <field name="res_model">lab.method.validation</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_lab_method_validation_search"/>
    </record>

    <menuitem id="menu_lab_method_validation" name="Method Validation" parent="menu_laboratory_quality" action="action_lab_method_validation" sequence="16"/>
</odoo>
